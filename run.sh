#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸ÐºÐ°

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸ÐºÐ°..."

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ .env Ñ„Ð°Ð¹Ð»Ð°
if [ ! -f .env ]; then
    echo "âš ï¸  Ð¤Ð°Ð¹Ð» .env Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!"
    echo "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» .env Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ env.example:"
    echo "   cp env.example .env"
    echo "   Ð—Ð°Ñ‚ÐµÐ¼ Ð·Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ ÐµÐ³Ð¾ Ð²Ð°ÑˆÐ¸Ð¼Ð¸ API ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸"
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
if ! python3 -c "import flask" 2>/dev/null; then
    echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
    pip install -r requirements.txt
fi

# Ð—Ð°Ð¿ÑƒÑÐº Ð±ÑÐºÐµÐ½Ð´Ð°
echo "ðŸ”§ Ð—Ð°Ð¿ÑƒÑÐº Ð±ÑÐºÐµÐ½Ð´Ð° Ð½Ð° http://localhost:5000"
cd backend
python3 app.py &
BACKEND_PID=$!

# ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±ÑÐºÐµÐ½Ð´Ð°
sleep 2

# Ð—Ð°Ð¿ÑƒÑÐº Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ð°
echo "ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ð° Ð½Ð° http://localhost:8000"
cd ../frontend
python3 -m http.server 8000 &
FRONTEND_PID=$!

echo ""
echo "âœ… Ð¡ÐµÑ€Ð²ÐµÑ€Ñ‹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹!"
echo "ðŸ“± ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ: http://localhost:8000"
echo ""
echo "Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"

# ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ ÑÐ¸Ð³Ð½Ð°Ð»Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ
trap "kill $BACKEND_PID $FRONTEND_PID 2>/dev/null; exit" INT TERM
wait

